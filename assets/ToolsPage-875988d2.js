import{_ as R,m as b,u as j,bD as Q,g as D,r as a,a as W,o as n,c as _,b as p,f as i,q as d,h as J,i as K,v as X,j as Y,k as Z,bW as $,C as h,s as I,e as V,t as T,w as ee}from"./index-95e8e165.js";import{C as S,I as H}from"./ChainHelper-da122e28.js";import{g as te,i as se,a as ae,b as ne,c as oe,f as ie,h as le,j as de,k as re,l as ce,m as k,n as q}from"./helpers-efec9615.js";import{d as F}from"./indexedDBCache-f3f71aef.js";import"./abi-d39c13d1.js";const ge={name:"ToolsPage",data(){return{Document:b(J),Headset:b(K),VideoCamera:b(X),FolderOpened:b(Y),Box:b(Z),Refresh:b($),activeTab:"holdings",queryAddress:"",querying:!1,loadingPage:!1,totalHoldings:0,holdingsPage:1,holdingsPageSize:5,holdingsCache:{},currentPageHoldings:[],cacheSize:0,cacheItems:0,testing:{getItem:!1,findInline:!1,getSymbolList:!1,getTokenInfoList:!1,getItemList:!1,readAddressCodes:!1,readData:!1,exists:!1,getSymbolListLength:!1,validateSymbol:!1,bytes32ToString:!1,clearCache:!1},testResults:[]}},async mounted(){},computed:{walletStore(){return j()}},methods:{fillCurrentAccount(){this.queryAddress=this.walletStore.account},async queryHoldings(){if(!this.queryAddress){this.$message.warning("Please enter an address");return}if(!Q(this.queryAddress)){this.$message.error("Invalid Ethereum address");return}this.querying=!0,this.totalHoldings=0,this.holdingsCache={},this.currentPageHoldings=[],this.holdingsPage=1;try{const c=S.getProvider(),y=await new H(c).balanceOf(this.queryAddress);if(this.totalHoldings=y,y===0){this.$message.info("No inscriptions found for this address");return}await this.loadPage(1)}catch(c){console.error("Failed to query holdings:",c),this.$message.error("Failed to query holdings")}finally{this.querying=!1}},async loadPage(c){if(this.holdingsCache[c]){this.currentPageHoldings=this.holdingsCache[c];return}this.loadingPage=!0;try{const o=S.getProvider(),y=new H(o),P=(c-1)*this.holdingsPageSize,l=Math.min(P+this.holdingsPageSize,this.totalHoldings),f=[];for(let r=P;r<l;r++)f.push(r);const x=await y.itemIdsByOwnerAndIndexList(this.queryAddress,f),v=[];for(const r of x)try{const t=await y.getItem(Number(r)),s={id:Number(r),dataType:t.dataType,userData:t.userData,fileName:te(t.userData),isImage:se(t.dataType),isSVG:ae(t.dataType),isText:ne(t.dataType),isTokenDeployment:oe(t.dataType),isAudio:ie(t.dataType),isVideo:le(t.dataType),isArchive:de(t.dataType),is3DModel:re(t.dataType),isPDF:ce(t.dataType),imageUrl:null,svgContent:null,text:null,isDataIncomplete:!1,incompleteDesc:null};try{if(t.dataType==="inline")s.text=k(D(t.inlineData));else{const u=await F.get(Number(r));if(u&&u.dataType===t.dataType){console.log(`Using cached content for item ${r}`);const g=D(u.dataHex);if(s.isText){const m=k(g);s.text=m.length>100?m.substring(0,100)+"...":m}else s.isImage?s.imageUrl=q(g,t.dataType):s.isSVG&&(s.svgContent=k(g))}else{const g=await y.readData(Number(r)),m=H.TryParseIncompleteHolderData(g);if(m)s.isDataIncomplete=!0,s.incompleteDesc=m.desc;else if(t.contentSize>0&&(s.isText||s.isImage||s.isSVG))if(await F.set(Number(r),g,t.dataType,!1),s.isText){const C=k(D(g));s.text=C.length>100?C.substring(0,100)+"...":C}else s.isImage?s.imageUrl=q(D(g),t.dataType):s.isSVG&&(s.svgContent=k(D(g)))}}}catch(u){console.error(`Failed to load content for item ${r}:`,u)}v.push(s)}catch(t){console.error(`Failed to load item ${r}:`,t)}this.holdingsCache[c]=v,this.currentPageHoldings=v}catch(o){console.error("Failed to load page:",o),this.$message.error("Failed to load page")}finally{this.loadingPage=!1}},async handlePageChange(c){await this.loadPage(c)}}},ue={class:"page-container"},pe={class:"holdings-section"},me={class:"address-input-group"},_e={key:0,class:"holdings-results"},he={class:"section-title"},ye={key:0,class:"text-preview"},fe={key:1,class:"content-preview"},Te=["src"],ve=["innerHTML"],be={key:3,class:"text-preview"},Ce={key:4,class:"token-deployment"},De={class:"token-symbol"},ke={key:5,class:"file-preview"},Pe={class:"userdata-cell"},xe={key:1,class:"empty-text"},Ie={class:"pagination-wrapper"};function He(c,o,y,P,l,f){const x=a("el-input"),v=a("el-button"),r=a("el-form-item"),t=a("el-form"),s=a("router-link"),u=a("el-table-column"),g=a("Coin"),m=a("el-icon"),C=a("el-space"),N=a("Headset"),U=a("VideoCamera"),z=a("FolderOpened"),w=a("Box"),A=a("Document"),B=a("el-tooltip"),L=a("el-table"),G=a("el-pagination"),M=a("el-tab-pane"),O=a("el-tabs"),E=W("loading");return n(),_("div",ue,[o[5]||(o[5]=p("h1",{class:"page-title"},"Tools",-1)),i(O,{modelValue:l.activeTab,"onUpdate:modelValue":o[2]||(o[2]=e=>l.activeTab=e)},{default:d(()=>[i(M,{label:"Query Holdings",name:"holdings"},{default:d(()=>[p("div",pe,[i(t,{"label-position":"top"},{default:d(()=>[i(r,{label:"Address"},{default:d(()=>[p("div",me,[i(x,{modelValue:l.queryAddress,"onUpdate:modelValue":o[0]||(o[0]=e=>l.queryAddress=e),placeholder:"Enter Ethereum address",class:"address-input",clearable:""},null,8,["modelValue"]),f.walletStore.isConnected?(n(),h(v,{key:0,type:"primary",onClick:f.fillCurrentAccount},{default:d(()=>[...o[3]||(o[3]=[I(" Fill Current Account ",-1)])]),_:1},8,["onClick"])):V("",!0)])]),_:1}),i(r,null,{default:d(()=>[i(v,{type:"primary",size:"large",loading:l.querying,onClick:f.queryHoldings},{default:d(()=>[...o[4]||(o[4]=[I(" Query ",-1)])]),_:1},8,["loading","onClick"])]),_:1})]),_:1}),l.totalHoldings>0?(n(),_("div",_e,[p("h3",he,"Holdings ("+T(l.totalHoldings)+" items)",1),ee((n(),h(L,{data:l.currentPageHoldings,stripe:""},{default:d(()=>[i(u,{label:"Inscription #",width:"120",align:"center"},{default:d(({row:e})=>[i(s,{to:`/detail/${e.id}`,class:"link"},{default:d(()=>[I(" #"+T(e.id),1)]),_:2},1032,["to"])]),_:1}),i(u,{label:"Content","min-width":"300"},{default:d(({row:e})=>[e.isDataIncomplete?(n(),_("div",ye,T(e.incompleteDesc),1)):e.isImage&&e.imageUrl?(n(),_("div",fe,[p("img",{src:e.imageUrl,alt:"Preview"},null,8,Te)])):e.isSVG&&e.svgContent?(n(),_("div",{key:2,class:"svg-preview",innerHTML:e.svgContent},null,8,ve)):e.isText?(n(),_("div",be,T(e.text),1)):e.isTokenDeployment?(n(),_("div",Ce,[i(C,{alignment:"center"},{default:d(()=>[i(m,{size:32},{default:d(()=>[i(g)]),_:1}),p("span",De,[p("strong",null,"$"+T(e.userData),1)])]),_:2},1024)])):(n(),_("div",ke,[i(m,{size:32},{default:d(()=>[e.isAudio?(n(),h(N,{key:0})):e.isVideo?(n(),h(U,{key:1})):e.isArchive?(n(),h(z,{key:2})):e.is3DModel?(n(),h(w,{key:3})):e.isPDF?(n(),h(A,{key:4})):(n(),h(A,{key:5}))]),_:2},1024),p("span",null,T(e.fileName),1)]))]),_:1}),i(u,{prop:"dataType",label:"Data Type",width:"180"}),i(u,{label:"User Data",width:"200"},{default:d(({row:e})=>[e.userData?(n(),h(B,{key:0,content:e.userData,placement:"top"},{default:d(()=>[p("div",Pe,T(e.userData),1)]),_:2},1032,["content"])):(n(),_("span",xe,"N/A"))]),_:1})]),_:1},8,["data"])),[[E,l.loadingPage]]),p("div",Ie,[i(G,{"current-page":l.holdingsPage,"onUpdate:currentPage":o[1]||(o[1]=e=>l.holdingsPage=e),"page-size":l.holdingsPageSize,total:l.totalHoldings,disabled:l.loadingPage,layout:"total, prev, pager, next",onCurrentChange:f.handlePageChange},null,8,["current-page","page-size","total","disabled","onCurrentChange"])])])):V("",!0)])]),_:1})]),_:1},8,["modelValue"])])}const Ne=R(ge,[["render",He],["__scopeId","data-v-1c1e90cd"]]);export{Ne as default};
