import{_ as V,$ as N,a0 as b,a1 as B,a2 as U,a3 as A,a4 as E,a5 as G,X as _}from"./element-plus-01463170.js";import{C as R,I as z}from"./ChainHelper-37f66626.js";import{_ as K,u as O}from"./index-35adf578.js";import{g as j,i as W,a as q,b as X,c as J,d as Q,e as Y,f as Z,h as $,j as ee,k as te,l as se,m as x,n as ae}from"./helpers-02a4fcea.js";import{d as L}from"./indexedDBCache-f3f71aef.js";import{aa as D,a8 as h,ac as oe,m as i,q as l,t as c,C as ne,G as ie,W as le,E as k,H as a,B as d,F as T}from"./vue-vendor-883c323d.js";import{g as C}from"./ethers-86161a64.js";import"./abi-d39c13d1.js";const re=15,de={name:"MainPage",data(){return{Document:D(V),Headset:D(N),VideoCamera:D(b),FolderOpened:D(B),Box:D(U),Coin:D(A),Loading:D(E),PictureFilled:D(G),loading:!1,inscriptions:[],currentPage:1,pageSize:re,total:0,forceRefreshKey:0}},computed:{walletStore(){return O()}},mounted(){this.loadInscriptions()},methods:{async loadInscriptions(){this.loading=!0;try{const o=R.getProvider(),t=new z(o),f=await t.getItemIdCounter();this.total=f;const g=f-(this.currentPage-1)*this.pageSize,n=Math.max(1,g-this.pageSize+1);if(n<=g&&g>0){const p=await t.getItemList(n,g);this.inscriptions=[];const m=[];for(let r=p.length-1;r>=0;r--){const s=p[r],u=g-(p.length-1-r),y={id:u,dataType:s.dataType,userData:s.userData,fileName:j(s.userData),isImage:W(s.dataType),isSVG:q(s.dataType),isText:X(s.dataType),isTokenDeployment:J(s.dataType),isMarkdown:Q(s.dataType),isHTML:Y(s.dataType),isAudio:Z(s.dataType),isVideo:$(s.dataType),isArchive:ee(s.dataType),is3DModel:te(s.dataType),isPDF:se(s.dataType),imageUrl:null,svgContent:null,text:null,isDataIncomplete:!1,incompleteDesc:null,isLoading:!1,isLargeData:!1,dataHolders:s.dataHolders},v=await L.get(u);v&&v.dataType===s.dataType?this.applyContentData(y,v.dataHex,s):s.inlineData&&s.inlineData.length>2?this.applyContentData(y,s.inlineData,s):y.isTokenDeployment?y.text=s.userData:s.dataHolders&&s.dataHolders.length>0&&(y.isImage||y.isSVG)&&(s.dataHolders.length>10?y.isLargeData=!0:(y.isLoading=!0,m.push({inscription:y,itemId:u,item:s}))),this.inscriptions.push(y)}this.loading=!1,m.length>0&&await this.batchLoadContent(m,t)}}catch(o){console.error("Failed to load inscriptions:",o),this.$message.error("Failed to load inscriptions")}finally{this.loading=!1}},async batchLoadContent(o,t){if(console.log("batchLoadContent",o),o.length>0)try{const g=o.slice(0,8),n=o.slice(8,8*2),p=[];g.length>0&&p.push(this.loadBatch(g,t)),n.length>0&&p.push(this.loadBatch(n,t)),await Promise.all(p)}catch(f){console.error("Failed to batch load content:",f),o.forEach(g=>{g.inscription.isLoading=!1,g.inscription.isLargeData=!0}),this.forceRefreshKey++}},async loadBatch(o,t){const f=o.map(n=>n.itemId),g=await t.readDataList(f);for(let n=0;n<o.length;n++){const{inscription:p,item:m}=o[n],r=g[n];try{const s=z.TryParseIncompleteHolderData(r);s?(p.isDataIncomplete=!0,p.incompleteDesc=s.desc):(this.applyContentData(p,r,m),await L.set(f[n],r,m.dataType,!1))}catch(s){console.error(`Failed to process content for item ${f[n]}:`,s),p.isLargeData=!0}p.isLoading=!1,this.forceRefreshKey++}},applyContentData(o,t,f){try{o.isText?o.text=x(C(t)):o.isImage?o.imageUrl=ae(C(t),f.dataType):o.isSVG&&(o.svgContent=x(C(t)))}catch(g){console.error("Failed to apply content data:",g)}},handleImageError(o){o.imageUrl=null,o.isLargeData=!0},handlePageChange(o){this.currentPage=o,this.loadInscriptions(),window.scrollTo({top:0,behavior:"smooth"})},goToDetail(o){this.$router.push(`/detail/${o}`)}}},ce={class:"page-container"},pe={class:"content-wrapper"},ge=["onClick"],_e={class:"card-content"},fe={key:0,class:"loading-content"},ue={key:1,class:"text-content"},ye=["src","alt","onError"],he=["innerHTML"],me={key:4,class:"text-content"},ve={key:5,class:"large-data-content"},De={key:6,class:"token-deployment-content"},Te={class:"token-symbol"},ke={key:7,class:"file-icon-content"},Ce={class:"file-name"},ze={key:8,class:"file-icon-content"},xe={class:"file-name"},Le={key:9,class:"file-icon-content"},Ie={class:"file-name"},we={key:10,class:"file-icon-content"},Fe={class:"file-name"},Pe={key:11,class:"file-icon-content"},Se={class:"file-name"},Me={key:12,class:"file-icon-content"},He={class:"file-name"},Ve={key:13,class:"file-icon-content"},Ne={class:"file-name"},be={key:14,class:"text-content"},Be={style:{"margin-top":"8px"}},Ue={class:"card-footer"},Ae={class:"footer-id"},Ee=["title"],Ge={key:1,class:"empty-state"},Re={key:2,class:"pagination-wrapper"};function Ke(o,t,f,g,n,p){const m=h("Loading"),r=h("el-icon"),s=h("PictureFilled"),u=h("el-tag"),y=h("Coin"),v=h("Document"),I=h("Headset"),w=h("VideoCamera"),F=h("FolderOpened"),P=h("Box"),S=h("el-pagination"),M=oe("loading");return i(),l("div",ce,[t[13]||(t[13]=c("h1",{class:"page-title"},"Latest Inscriptions",-1)),ne((i(),l("div",pe,[n.inscriptions.length>0?(i(),l("div",{class:"inscription-grid",key:n.forceRefreshKey},[(i(!0),l(ie,null,le(n.inscriptions,e=>(i(),l("div",{key:e.id,class:"inscription-card card-hover",onClick:H=>p.goToDetail(e.id)},[c("div",_e,[e.isLoading?(i(),l("div",fe,[a(r,{class:"is-loading",size:32,color:"#409EFF"},{default:d(()=>[a(m)]),_:1}),t[2]||(t[2]=c("p",null,"Loading content...",-1))])):e.isDataIncomplete?(i(),l("div",ue,_(e.incompleteDesc),1)):e.isImage&&e.imageUrl&&!e.isLargeData?(i(),l("img",{key:2,src:e.imageUrl,alt:`Inscription #${e.id}`,onError:H=>p.handleImageError(e)},null,40,ye)):e.isSVG&&e.svgContent?(i(),l("div",{key:3,innerHTML:e.svgContent,class:"svg-content"},null,8,he)):e.isText&&!e.isLargeData?(i(),l("div",me,_(e.text),1)):(e.isImage||e.isSVG||e.isText)&&e.isLargeData?(i(),l("div",ve,[a(r,{size:48,color:"#909399"},{default:d(()=>[a(s)]),_:1}),t[4]||(t[4]=c("p",null,"Large Media File",-1)),a(u,{size:"small",type:"info"},{default:d(()=>[...t[3]||(t[3]=[T("Click to view",-1)])]),_:1})])):e.isTokenDeployment?(i(),l("div",De,[a(r,{size:64},{default:d(()=>[a(y)]),_:1}),c("p",Te,[c("strong",null,"$"+_(e.text),1)])])):e.isMarkdown?(i(),l("div",ke,[a(r,{size:48},{default:d(()=>[a(v)]),_:1}),c("div",Ce,_(e.fileName),1),a(u,{size:"small"},{default:d(()=>[...t[5]||(t[5]=[T("Markdown",-1)])]),_:1})])):e.isHTML?(i(),l("div",ze,[a(r,{size:48},{default:d(()=>[a(v)]),_:1}),c("div",xe,_(e.fileName),1),a(u,{size:"small"},{default:d(()=>[...t[6]||(t[6]=[T("HTML",-1)])]),_:1})])):e.isAudio?(i(),l("div",Le,[a(r,{size:48},{default:d(()=>[a(I)]),_:1}),c("div",Ie,_(e.fileName),1),a(u,{size:"small",type:"success"},{default:d(()=>[...t[7]||(t[7]=[T("Audio",-1)])]),_:1})])):e.isVideo?(i(),l("div",we,[a(r,{size:48},{default:d(()=>[a(w)]),_:1}),c("div",Fe,_(e.fileName),1),a(u,{size:"small",type:"warning"},{default:d(()=>[...t[8]||(t[8]=[T("Video",-1)])]),_:1})])):e.isArchive?(i(),l("div",Pe,[a(r,{size:48},{default:d(()=>[a(F)]),_:1}),c("div",Se,_(e.fileName),1),a(u,{size:"small",type:"info"},{default:d(()=>[...t[9]||(t[9]=[T("Archive",-1)])]),_:1})])):e.is3DModel?(i(),l("div",Me,[a(r,{size:48},{default:d(()=>[a(P)]),_:1}),c("div",He,_(e.fileName),1),a(u,{size:"small",type:"danger"},{default:d(()=>[...t[10]||(t[10]=[T("3D Model",-1)])]),_:1})])):e.isPDF?(i(),l("div",Ve,[a(r,{size:48},{default:d(()=>[a(v)]),_:1}),c("div",Ne,_(e.fileName),1),a(u,{size:"small",type:"danger"},{default:d(()=>[...t[11]||(t[11]=[T("PDF",-1)])]),_:1})])):(i(),l("div",be,[a(r,{size:48},{default:d(()=>[a(v)]),_:1}),c("div",Be,_(e.dataType),1)]))]),c("div",Ue,[c("div",Ae,"Inscription #"+_(e.id),1),e.userData?(i(),l("div",{key:0,class:"footer-userdata",title:e.userData},_(e.isTokenDeployment?"Token Deployment":e.userData),9,Ee)):k("",!0)])],8,ge))),128))])):n.loading?k("",!0):(i(),l("div",Ge,[...t[12]||(t[12]=[c("div",{class:"empty-icon"},"ðŸ“",-1),c("div",{class:"empty-text"},"No inscriptions found",-1)])])),n.total>n.pageSize?(i(),l("div",Re,[a(S,{"current-page":n.currentPage,"onUpdate:currentPage":t[0]||(t[0]=e=>n.currentPage=e),"page-size":n.pageSize,"onUpdate:pageSize":t[1]||(t[1]=e=>n.pageSize=e),total:n.total,"page-sizes":[n.pageSize],layout:"total, prev, pager, next, jumper",onCurrentChange:p.handlePageChange},null,8,["current-page","page-size","total","page-sizes","onCurrentChange"])])):k("",!0)])),[[M,n.loading]])])}const Ze=K(de,[["render",Ke],["__scopeId","data-v-6773511d"]]);export{Ze as default};
