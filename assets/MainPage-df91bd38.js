import{_ as V,m as D,u as b,g as k,r as y,a as N,o as i,c as l,b as c,w as B,F as U,d as A,e as z,f as a,h as E,i as G,v as R,j as K,k as j,l as O,n as q,p as W,q as r,t as f,s as T}from"./index-1f4d9e88.js";import{C as J,I as C}from"./ChainHelper-c678602a.js";import{g as Q,i as X,a as Y,b as Z,c as $,d as ee,e as te,f as se,h as ae,j as oe,k as ne,l as ie,m as x,n as le}from"./helpers-f5163dcf.js";import{d as L}from"./indexedDBCache-f3f71aef.js";import"./abi-d39c13d1.js";const de=15,re={name:"MainPage",data(){return{Document:D(E),Headset:D(G),VideoCamera:D(R),FolderOpened:D(K),Box:D(j),Coin:D(O),Loading:D(q),PictureFilled:D(W),loading:!1,inscriptions:[],currentPage:1,pageSize:de,total:0,forceRefreshKey:0}},computed:{walletStore(){return b()}},mounted(){this.loadInscriptions()},methods:{async loadInscriptions(){this.loading=!0;try{const o=J.getProvider(),t=new C(o),u=await t.getItemIdCounter();this.total=u;const g=u-(this.currentPage-1)*this.pageSize,n=Math.max(1,g-this.pageSize+1);if(n<=g&&g>0){const p=await t.getItemList(n,g);this.inscriptions=[];const m=[];for(let d=p.length-1;d>=0;d--){const s=p[d],h=g-(p.length-1-d),_={id:h,dataType:s.dataType,userData:s.userData,fileName:Q(s.userData),isImage:X(s.dataType),isSVG:Y(s.dataType),isText:Z(s.dataType),isTokenDeployment:$(s.dataType),isMarkdown:ee(s.dataType),isHTML:te(s.dataType),isAudio:se(s.dataType),isVideo:ae(s.dataType),isArchive:oe(s.dataType),is3DModel:ne(s.dataType),isPDF:ie(s.dataType),imageUrl:null,svgContent:null,text:null,isDataIncomplete:!1,incompleteDesc:null,isLoading:!1,isLargeData:!1,dataHolders:s.dataHolders},v=await L.get(h);v&&v.dataType===s.dataType?this.applyContentData(_,v.dataHex,s):s.inlineData&&s.inlineData.length>2?this.applyContentData(_,s.inlineData,s):_.isTokenDeployment?_.text=s.userData:s.dataHolders&&s.dataHolders.length>0&&(_.isImage||_.isSVG||_.isText)&&(s.dataHolders.length>10?_.isLargeData=!0:(_.isLoading=!0,m.push({inscription:_,itemId:h,item:s}))),this.inscriptions.push(_)}this.loading=!1,m.length>0&&await this.batchLoadContent(m,t)}}catch(o){console.error("Failed to load inscriptions:",o),this.$message.error("Failed to load inscriptions")}finally{this.loading=!1}},async batchLoadContent(o,t){if(console.log("batchLoadContent",o),o.length>0)try{const g=o.slice(0,8),n=o.slice(8,8*2),p=[];g.length>0&&p.push(this.loadBatch(g,t)),n.length>0&&p.push(this.loadBatch(n,t)),await Promise.all(p)}catch(u){console.error("Failed to batch load content:",u),o.forEach(g=>{g.inscription.isLoading=!1,g.inscription.isLargeData=!0}),this.forceRefreshKey++}},async loadBatch(o,t){const u=o.map(n=>n.itemId),g=await t.readDataList(u);for(let n=0;n<o.length;n++){const{inscription:p,item:m}=o[n],d=g[n];try{const s=C.TryParseIncompleteHolderData(d);s?(p.isDataIncomplete=!0,p.incompleteDesc=s.desc):(this.applyContentData(p,d,m),await L.set(u[n],d,m.dataType,!1))}catch(s){console.error(`Failed to process content for item ${u[n]}:`,s),p.isLargeData=!0}p.isLoading=!1,this.forceRefreshKey++}},applyContentData(o,t,u){try{o.isText?o.text=x(k(t)):o.isImage?o.imageUrl=le(k(t),u.dataType):o.isSVG&&(o.svgContent=x(k(t)))}catch(g){console.error("Failed to apply content data:",g)}},handleImageError(o){o.imageUrl=null,o.isLargeData=!0},handlePageChange(o){this.currentPage=o,this.loadInscriptions(),window.scrollTo({top:0,behavior:"smooth"})},goToDetail(o){this.$router.push(`/detail/${o}`)}}},ce={class:"page-container"},pe={class:"content-wrapper"},ge=["onClick"],_e={class:"card-content"},fe={key:0,class:"loading-content"},ue={key:1,class:"text-content"},he=["src","alt","onError"],ye=["innerHTML"],me={key:4,class:"text-content"},ve={key:5,class:"large-data-content"},De={key:6,class:"token-deployment-content"},Te={class:"token-symbol"},ke={key:7,class:"file-icon-content"},ze={class:"file-name"},Ce={key:8,class:"file-icon-content"},xe={class:"file-name"},Le={key:9,class:"file-icon-content"},Ie={class:"file-name"},we={key:10,class:"file-icon-content"},Fe={class:"file-name"},Pe={key:11,class:"file-icon-content"},Se={class:"file-name"},Me={key:12,class:"file-icon-content"},He={class:"file-name"},Ve={key:13,class:"file-icon-content"},be={class:"file-name"},Ne={key:14,class:"text-content"},Be={style:{"margin-top":"8px"}},Ue={class:"card-footer"},Ae={class:"footer-id"},Ee=["title"],Ge={key:1,class:"empty-state"},Re={key:2,class:"pagination-wrapper"};function Ke(o,t,u,g,n,p){const m=y("Loading"),d=y("el-icon"),s=y("PictureFilled"),h=y("el-tag"),_=y("Coin"),v=y("Document"),I=y("Headset"),w=y("VideoCamera"),F=y("FolderOpened"),P=y("Box"),S=y("el-pagination"),M=N("loading");return i(),l("div",ce,[t[13]||(t[13]=c("h1",{class:"page-title"},"Latest Inscriptions",-1)),B((i(),l("div",pe,[n.inscriptions.length>0?(i(),l("div",{class:"inscription-grid",key:n.forceRefreshKey},[(i(!0),l(U,null,A(n.inscriptions,e=>(i(),l("div",{key:e.id,class:"inscription-card card-hover",onClick:H=>p.goToDetail(e.id)},[c("div",_e,[e.isLoading?(i(),l("div",fe,[a(d,{class:"is-loading",size:32,color:"#409EFF"},{default:r(()=>[a(m)]),_:1}),t[2]||(t[2]=c("p",null,"Loading content...",-1))])):e.isDataIncomplete?(i(),l("div",ue,f(e.incompleteDesc),1)):e.isImage&&e.imageUrl&&!e.isLargeData?(i(),l("img",{key:2,src:e.imageUrl,alt:`Inscription #${e.id}`,onError:H=>p.handleImageError(e)},null,40,he)):e.isSVG&&e.svgContent?(i(),l("div",{key:3,innerHTML:e.svgContent,class:"svg-content"},null,8,ye)):e.isText&&!e.isLargeData?(i(),l("div",me,f(e.text),1)):(e.isImage||e.isSVG||e.isText)&&e.isLargeData?(i(),l("div",ve,[a(d,{size:48,color:"#909399"},{default:r(()=>[a(s)]),_:1}),t[4]||(t[4]=c("p",null,"Large Media File",-1)),a(h,{size:"small",type:"info"},{default:r(()=>[...t[3]||(t[3]=[T("Click to view",-1)])]),_:1})])):e.isTokenDeployment?(i(),l("div",De,[a(d,{size:64},{default:r(()=>[a(_)]),_:1}),c("p",Te,[c("strong",null,"$"+f(e.text),1)])])):e.isMarkdown?(i(),l("div",ke,[a(d,{size:48},{default:r(()=>[a(v)]),_:1}),c("div",ze,f(e.fileName),1),a(h,{size:"small"},{default:r(()=>[...t[5]||(t[5]=[T("Markdown",-1)])]),_:1})])):e.isHTML?(i(),l("div",Ce,[a(d,{size:48},{default:r(()=>[a(v)]),_:1}),c("div",xe,f(e.fileName),1),a(h,{size:"small"},{default:r(()=>[...t[6]||(t[6]=[T("HTML",-1)])]),_:1})])):e.isAudio?(i(),l("div",Le,[a(d,{size:48},{default:r(()=>[a(I)]),_:1}),c("div",Ie,f(e.fileName),1),a(h,{size:"small",type:"success"},{default:r(()=>[...t[7]||(t[7]=[T("Audio",-1)])]),_:1})])):e.isVideo?(i(),l("div",we,[a(d,{size:48},{default:r(()=>[a(w)]),_:1}),c("div",Fe,f(e.fileName),1),a(h,{size:"small",type:"warning"},{default:r(()=>[...t[8]||(t[8]=[T("Video",-1)])]),_:1})])):e.isArchive?(i(),l("div",Pe,[a(d,{size:48},{default:r(()=>[a(F)]),_:1}),c("div",Se,f(e.fileName),1),a(h,{size:"small",type:"info"},{default:r(()=>[...t[9]||(t[9]=[T("Archive",-1)])]),_:1})])):e.is3DModel?(i(),l("div",Me,[a(d,{size:48},{default:r(()=>[a(P)]),_:1}),c("div",He,f(e.fileName),1),a(h,{size:"small",type:"danger"},{default:r(()=>[...t[10]||(t[10]=[T("3D Model",-1)])]),_:1})])):e.isPDF?(i(),l("div",Ve,[a(d,{size:48},{default:r(()=>[a(v)]),_:1}),c("div",be,f(e.fileName),1),a(h,{size:"small",type:"danger"},{default:r(()=>[...t[11]||(t[11]=[T("PDF",-1)])]),_:1})])):(i(),l("div",Ne,[a(d,{size:48},{default:r(()=>[a(v)]),_:1}),c("div",Be,f(e.dataType),1)]))]),c("div",Ue,[c("div",Ae,"Inscription #"+f(e.id),1),e.userData?(i(),l("div",{key:0,class:"footer-userdata",title:e.userData},f(e.isTokenDeployment?"Token Deployment":e.userData),9,Ee)):z("",!0)])],8,ge))),128))])):n.loading?z("",!0):(i(),l("div",Ge,[...t[12]||(t[12]=[c("div",{class:"empty-icon"},"ðŸ“",-1),c("div",{class:"empty-text"},"No inscriptions found",-1)])])),n.total>n.pageSize?(i(),l("div",Re,[a(S,{"current-page":n.currentPage,"onUpdate:currentPage":t[0]||(t[0]=e=>n.currentPage=e),"page-size":n.pageSize,"onUpdate:pageSize":t[1]||(t[1]=e=>n.pageSize=e),total:n.total,"page-sizes":[n.pageSize],layout:"total, prev, pager, next, jumper",onCurrentChange:p.handlePageChange},null,8,["current-page","page-size","total","page-sizes","onCurrentChange"])])):z("",!0)])),[[M,n.loading]])])}const Qe=V(re,[["render",Ke],["__scopeId","data-v-27188636"]]);export{Qe as default};
