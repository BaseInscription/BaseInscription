import{_ as O,m as D,u as j,bD as Q,g as k,r as a,a as W,o as n,c as m,b as u,f as i,q as r,h as J,i as K,v as X,j as Y,k as Z,bW as $,D as _,s as V,e as N,t as T,w as ee}from"./index-8461e468.js";import{C as U,I as S}from"./ChainHelper-e7579f76.js";import{g as te,i as se,a as ae,b as ne,c as oe,f as ie,h as le,j as re,k as de,l as ce,m as x,n as z}from"./helpers-c9c8e6e2.js";import{d as w}from"./indexedDBCache-f3f71aef.js";import"./abi-cde10b30.js";const ge={name:"ToolsPage",data(){return{Document:D(J),Headset:D(K),VideoCamera:D(X),FolderOpened:D(Y),Box:D(Z),Refresh:D($),activeTab:"holdings",queryAddress:"",querying:!1,loadingPage:!1,totalHoldings:0,holdingsPage:1,holdingsPageSize:5,holdingsCache:{},currentPageHoldings:[],cacheSize:0,cacheItems:0,testing:{getItem:!1,findInline:!1,getSymbolList:!1,getTokenInfoList:!1,getItemList:!1,readAddressCodes:!1,readData:!1,exists:!1,getSymbolListLength:!1,validateSymbol:!1,bytes32ToString:!1,clearCache:!1},testResults:[]}},async mounted(){},computed:{walletStore(){return j()}},methods:{fillCurrentAccount(){this.queryAddress=this.walletStore.account},async queryHoldings(){if(!this.queryAddress){this.$message.warning("Please enter an address");return}if(!Q(this.queryAddress)){this.$message.error("Invalid Ethereum address");return}this.querying=!0,this.totalHoldings=0,this.holdingsCache={},this.currentPageHoldings=[],this.holdingsPage=1;try{const g=U.getProvider(),f=await new S(g).balanceOf(this.queryAddress);if(this.totalHoldings=f,f===0){this.$message.info("No inscriptions found for this address");return}await this.loadPage(1)}catch(g){console.error("Failed to query holdings:",g),this.$message.error("Failed to query holdings")}finally{this.querying=!1}},async loadPage(g){var l;if(this.holdingsCache[g]){this.currentPageHoldings=this.holdingsCache[g];return}this.loadingPage=!0;try{const f=U.getProvider(),P=new S(f),o=(g-1)*this.holdingsPageSize,v=Math.min(o+this.holdingsPageSize,this.totalHoldings),I=[];for(let d=o;d<v;d++)I.push(d);const H=await P.itemIdsByOwnerAndIndexList(this.queryAddress,I),b=[];for(const d of H)try{const s=await P.getItem(Number(d)),t={id:Number(d),dataType:s.dataType,userData:s.userData,fileName:te(s.userData),isImage:se(s.dataType),isSVG:ae(s.dataType),isText:ne(s.dataType),isTokenDeployment:oe(s.dataType),isAudio:ie(s.dataType),isVideo:le(s.dataType),isArchive:re(s.dataType),is3DModel:de(s.dataType),isPDF:ce(s.dataType),imageUrl:null,svgContent:null,text:null,isDataIncomplete:!1,incompleteDesc:null};try{if(s.dataType==="inline")t.text=x(k(s.inlineData));else{const y=await w.get(Number(d));if(y&&y.dataType===s.dataType){console.log(`Using cached content for item ${d}`);const c=k(y.dataHex);if(t.isText){const p=x(c);t.text=p.length>100?p.substring(0,100)+"...":p}else t.isImage?t.imageUrl=z(c,s.dataType):t.isSVG&&(t.svgContent=x(c))}else{let[c,p]=[null,null];try{c=await P.readData(Number(d))}catch(h){const A=((l=h.error)==null?void 0:l.data)||h.data;if(A){const C=S.GetErrorIFace().parseError(A);p=!0,C.name=="InvalidRead"&&C.args.tag==1?t.incompleteDesc=`Incomplete chunks: ${C.args.param1}/${C.args.param2}`:t.incompleteDesc="Read error"}else t.incompleteDesc="Read error"}if(t.isDataIncomplete=p,!p){if(s.contentSize>0&&(t.isText||t.isImage||t.isSVG))if(await w.set(Number(d),c,s.dataType,!1),t.isText){const h=x(k(c));t.text=h.length>100?h.substring(0,100)+"...":h}else t.isImage?t.imageUrl=z(k(c),s.dataType):t.isSVG&&(t.svgContent=x(k(c)))}}}}catch(y){console.error(`Failed to load content for item ${d}:`,y)}b.push(t)}catch(s){console.error(`Failed to load item ${d}:`,s)}this.holdingsCache[g]=b,this.currentPageHoldings=b}catch(f){console.error("Failed to load page:",f),this.$message.error("Failed to load page")}finally{this.loadingPage=!1}},async handlePageChange(g){await this.loadPage(g)}}},ue={class:"page-container"},pe={class:"holdings-section"},me={class:"address-input-group"},_e={key:0,class:"holdings-results"},he={class:"section-title"},fe={key:0,class:"text-preview"},ye={key:1,class:"content-preview"},Te=["src"],ve=["innerHTML"],be={key:3,class:"text-preview"},Ce={key:4,class:"token-deployment"},De={class:"token-symbol"},ke={key:5,class:"file-preview"},xe={class:"userdata-cell"},Pe={key:1,class:"empty-text"},Ie={class:"pagination-wrapper"};function He(g,l,f,P,o,v){const I=a("el-input"),H=a("el-button"),b=a("el-form-item"),d=a("el-form"),s=a("router-link"),t=a("el-table-column"),y=a("Coin"),c=a("el-icon"),p=a("el-space"),h=a("Headset"),A=a("VideoCamera"),q=a("FolderOpened"),C=a("Box"),F=a("Document"),B=a("el-tooltip"),L=a("el-table"),G=a("el-pagination"),R=a("el-tab-pane"),E=a("el-tabs"),M=W("loading");return n(),m("div",ue,[l[5]||(l[5]=u("h1",{class:"page-title"},"Tools",-1)),i(E,{modelValue:o.activeTab,"onUpdate:modelValue":l[2]||(l[2]=e=>o.activeTab=e)},{default:r(()=>[i(R,{label:"Query Holdings",name:"holdings"},{default:r(()=>[u("div",pe,[i(d,{"label-position":"top"},{default:r(()=>[i(b,{label:"Address"},{default:r(()=>[u("div",me,[i(I,{modelValue:o.queryAddress,"onUpdate:modelValue":l[0]||(l[0]=e=>o.queryAddress=e),placeholder:"Enter Ethereum address",class:"address-input",clearable:""},null,8,["modelValue"]),v.walletStore.isConnected?(n(),_(H,{key:0,type:"primary",onClick:v.fillCurrentAccount},{default:r(()=>[...l[3]||(l[3]=[V(" Fill Current Account ",-1)])]),_:1},8,["onClick"])):N("",!0)])]),_:1}),i(b,null,{default:r(()=>[i(H,{type:"primary",size:"large",loading:o.querying,onClick:v.queryHoldings},{default:r(()=>[...l[4]||(l[4]=[V(" Query ",-1)])]),_:1},8,["loading","onClick"])]),_:1})]),_:1}),o.totalHoldings>0?(n(),m("div",_e,[u("h3",he,"Holdings ("+T(o.totalHoldings)+" items)",1),ee((n(),_(L,{data:o.currentPageHoldings,stripe:""},{default:r(()=>[i(t,{label:"Inscription #",width:"120",align:"center"},{default:r(({row:e})=>[i(s,{to:`/detail/${e.id}`,class:"link"},{default:r(()=>[V(" #"+T(e.id),1)]),_:2},1032,["to"])]),_:1}),i(t,{label:"Content","min-width":"300"},{default:r(({row:e})=>[e.isDataIncomplete?(n(),m("div",fe,T(e.incompleteDesc),1)):e.isImage&&e.imageUrl?(n(),m("div",ye,[u("img",{src:e.imageUrl,alt:"Preview"},null,8,Te)])):e.isSVG&&e.svgContent?(n(),m("div",{key:2,class:"svg-preview",innerHTML:e.svgContent},null,8,ve)):e.isText?(n(),m("div",be,T(e.text),1)):e.isTokenDeployment?(n(),m("div",Ce,[i(p,{alignment:"center"},{default:r(()=>[i(c,{size:32},{default:r(()=>[i(y)]),_:1}),u("span",De,[u("strong",null,"$"+T(e.userData),1)])]),_:2},1024)])):(n(),m("div",ke,[i(c,{size:32},{default:r(()=>[e.isAudio?(n(),_(h,{key:0})):e.isVideo?(n(),_(A,{key:1})):e.isArchive?(n(),_(q,{key:2})):e.is3DModel?(n(),_(C,{key:3})):e.isPDF?(n(),_(F,{key:4})):(n(),_(F,{key:5}))]),_:2},1024),u("span",null,T(e.fileName),1)]))]),_:1}),i(t,{prop:"dataType",label:"Data Type",width:"180"}),i(t,{label:"User Data",width:"200"},{default:r(({row:e})=>[e.userData?(n(),_(B,{key:0,content:e.userData,placement:"top"},{default:r(()=>[u("div",xe,T(e.userData),1)]),_:2},1032,["content"])):(n(),m("span",Pe,"N/A"))]),_:1})]),_:1},8,["data"])),[[M,o.loadingPage]]),u("div",Ie,[i(G,{"current-page":o.holdingsPage,"onUpdate:currentPage":l[1]||(l[1]=e=>o.holdingsPage=e),"page-size":o.holdingsPageSize,total:o.totalHoldings,disabled:o.loadingPage,layout:"total, prev, pager, next",onCurrentChange:v.handlePageChange},null,8,["current-page","page-size","total","disabled","onCurrentChange"])])])):N("",!0)])]),_:1})]),_:1},8,["modelValue"])])}const Ne=O(ge,[["render",He],["__scopeId","data-v-474ebf5d"]]);export{Ne as default};
