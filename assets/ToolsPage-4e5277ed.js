import{_ as R,$ as Q,a0 as j,a1 as W,a2 as X,ah as J,X as T}from"./element-plus-01463170.js";import{C as V,I}from"./ChainHelper-37f66626.js";import{_ as K,u as Y}from"./index-35adf578.js";import{g as Z,i as $,a as ee,b as te,c as se,f as ae,h as oe,j as ne,k as ie,l as le,m as D,n as S}from"./helpers-02a4fcea.js";import{d as q}from"./indexedDBCache-f3f71aef.js";import{aa as b,a8 as a,ac as de,m as o,q as _,t as p,H as i,B as d,A as h,F as H,E as F,C as re}from"./vue-vendor-883c323d.js";import{i as ce,g as P}from"./ethers-86161a64.js";import"./abi-d39c13d1.js";const ge={name:"ToolsPage",data(){return{Document:b(R),Headset:b(Q),VideoCamera:b(j),FolderOpened:b(W),Box:b(X),Refresh:b(J),activeTab:"holdings",queryAddress:"",querying:!1,loadingPage:!1,totalHoldings:0,holdingsPage:1,holdingsPageSize:5,holdingsCache:{},currentPageHoldings:[],cacheSize:0,cacheItems:0,testing:{getItem:!1,findInline:!1,getSymbolList:!1,getTokenInfoList:!1,getItemList:!1,readAddressCodes:!1,readData:!1,exists:!1,getSymbolListLength:!1,validateSymbol:!1,bytes32ToString:!1,clearCache:!1},testResults:[]}},async mounted(){},computed:{walletStore(){return Y()}},methods:{fillCurrentAccount(){this.queryAddress=this.walletStore.account},async queryHoldings(){if(!this.queryAddress){this.$message.warning("Please enter an address");return}if(!ce(this.queryAddress)){this.$message.error("Invalid Ethereum address");return}this.querying=!0,this.totalHoldings=0,this.holdingsCache={},this.currentPageHoldings=[],this.holdingsPage=1;try{const c=V.getProvider(),y=await new I(c).balanceOf(this.queryAddress);if(this.totalHoldings=y,y===0){this.$message.info("No inscriptions found for this address");return}await this.loadPage(1)}catch(c){console.error("Failed to query holdings:",c),this.$message.error("Failed to query holdings")}finally{this.querying=!1}},async loadPage(c){if(this.holdingsCache[c]){this.currentPageHoldings=this.holdingsCache[c];return}this.loadingPage=!0;try{const n=V.getProvider(),y=new I(n),k=(c-1)*this.holdingsPageSize,l=Math.min(k+this.holdingsPageSize,this.totalHoldings),f=[];for(let r=k;r<l;r++)f.push(r);const x=await y.itemIdsByOwnerAndIndexList(this.queryAddress,f),v=[];for(const r of x)try{const t=await y.getItem(Number(r)),s={id:Number(r),dataType:t.dataType,userData:t.userData,fileName:Z(t.userData),isImage:$(t.dataType),isSVG:ee(t.dataType),isText:te(t.dataType),isTokenDeployment:se(t.dataType),isAudio:ae(t.dataType),isVideo:oe(t.dataType),isArchive:ne(t.dataType),is3DModel:ie(t.dataType),isPDF:le(t.dataType),imageUrl:null,svgContent:null,text:null,isDataIncomplete:!1,incompleteDesc:null};try{if(t.dataType==="inline")s.text=D(P(t.inlineData));else{const u=await q.get(Number(r));if(u&&u.dataType===t.dataType){console.log(`Using cached content for item ${r}`);const g=P(u.dataHex);if(s.isText){const m=D(g);s.text=m.length>100?m.substring(0,100)+"...":m}else s.isImage?s.imageUrl=S(g,t.dataType):s.isSVG&&(s.svgContent=D(g))}else{const g=await y.readData(Number(r)),m=I.TryParseIncompleteHolderData(g);if(m)s.isDataIncomplete=!0,s.incompleteDesc=m.desc;else if(t.contentSize>0&&(s.isText||s.isImage||s.isSVG))if(await q.set(Number(r),g,t.dataType,!1),s.isText){const C=D(P(g));s.text=C.length>100?C.substring(0,100)+"...":C}else s.isImage?s.imageUrl=S(P(g),t.dataType):s.isSVG&&(s.svgContent=D(P(g)))}}}catch(u){console.error(`Failed to load content for item ${r}:`,u)}v.push(s)}catch(t){console.error(`Failed to load item ${r}:`,t)}this.holdingsCache[c]=v,this.currentPageHoldings=v}catch(n){console.error("Failed to load page:",n),this.$message.error("Failed to load page")}finally{this.loadingPage=!1}},async handlePageChange(c){await this.loadPage(c)}}},ue={class:"page-container"},pe={class:"holdings-section"},me={class:"address-input-group"},_e={key:0,class:"holdings-results"},he={class:"section-title"},ye={key:0,class:"text-preview"},fe={key:1,class:"content-preview"},Te=["src"],ve=["innerHTML"],be={key:3,class:"text-preview"},Ce={key:4,class:"token-deployment"},De={class:"token-symbol"},Pe={key:5,class:"file-preview"},ke={class:"userdata-cell"},xe={key:1,class:"empty-text"},Ie={class:"pagination-wrapper"};function He(c,n,y,k,l,f){const x=a("el-input"),v=a("el-button"),r=a("el-form-item"),t=a("el-form"),s=a("router-link"),u=a("el-table-column"),g=a("Coin"),m=a("el-icon"),C=a("el-space"),N=a("Headset"),U=a("VideoCamera"),z=a("FolderOpened"),B=a("Box"),A=a("Document"),w=a("el-tooltip"),L=a("el-table"),G=a("el-pagination"),M=a("el-tab-pane"),E=a("el-tabs"),O=de("loading");return o(),_("div",ue,[n[5]||(n[5]=p("h1",{class:"page-title"},"Tools",-1)),i(E,{modelValue:l.activeTab,"onUpdate:modelValue":n[2]||(n[2]=e=>l.activeTab=e)},{default:d(()=>[i(M,{label:"Query Holdings",name:"holdings"},{default:d(()=>[p("div",pe,[i(t,{"label-position":"top"},{default:d(()=>[i(r,{label:"Address"},{default:d(()=>[p("div",me,[i(x,{modelValue:l.queryAddress,"onUpdate:modelValue":n[0]||(n[0]=e=>l.queryAddress=e),placeholder:"Enter Ethereum address",class:"address-input",clearable:""},null,8,["modelValue"]),f.walletStore.isConnected?(o(),h(v,{key:0,type:"primary",onClick:f.fillCurrentAccount},{default:d(()=>[...n[3]||(n[3]=[H(" Fill Current Account ",-1)])]),_:1},8,["onClick"])):F("",!0)])]),_:1}),i(r,null,{default:d(()=>[i(v,{type:"primary",size:"large",loading:l.querying,onClick:f.queryHoldings},{default:d(()=>[...n[4]||(n[4]=[H(" Query ",-1)])]),_:1},8,["loading","onClick"])]),_:1})]),_:1}),l.totalHoldings>0?(o(),_("div",_e,[p("h3",he,"Holdings ("+T(l.totalHoldings)+" items)",1),re((o(),h(L,{data:l.currentPageHoldings,stripe:""},{default:d(()=>[i(u,{label:"Inscription #",width:"120",align:"center"},{default:d(({row:e})=>[i(s,{to:`/detail/${e.id}`,class:"link"},{default:d(()=>[H(" #"+T(e.id),1)]),_:2},1032,["to"])]),_:1}),i(u,{label:"Content","min-width":"300"},{default:d(({row:e})=>[e.isDataIncomplete?(o(),_("div",ye,T(e.incompleteDesc),1)):e.isImage&&e.imageUrl?(o(),_("div",fe,[p("img",{src:e.imageUrl,alt:"Preview"},null,8,Te)])):e.isSVG&&e.svgContent?(o(),_("div",{key:2,class:"svg-preview",innerHTML:e.svgContent},null,8,ve)):e.isText?(o(),_("div",be,T(e.text),1)):e.isTokenDeployment?(o(),_("div",Ce,[i(C,{alignment:"center"},{default:d(()=>[i(m,{size:32},{default:d(()=>[i(g)]),_:1}),p("span",De,[p("strong",null,"$"+T(e.userData),1)])]),_:2},1024)])):(o(),_("div",Pe,[i(m,{size:32},{default:d(()=>[e.isAudio?(o(),h(N,{key:0})):e.isVideo?(o(),h(U,{key:1})):e.isArchive?(o(),h(z,{key:2})):e.is3DModel?(o(),h(B,{key:3})):e.isPDF?(o(),h(A,{key:4})):(o(),h(A,{key:5}))]),_:2},1024),p("span",null,T(e.fileName),1)]))]),_:1}),i(u,{prop:"dataType",label:"Data Type",width:"180"}),i(u,{label:"User Data",width:"200"},{default:d(({row:e})=>[e.userData?(o(),h(w,{key:0,content:e.userData,placement:"top"},{default:d(()=>[p("div",ke,T(e.userData),1)]),_:2},1032,["content"])):(o(),_("span",xe,"N/A"))]),_:1})]),_:1},8,["data"])),[[O,l.loadingPage]]),p("div",Ie,[i(G,{"current-page":l.holdingsPage,"onUpdate:currentPage":n[1]||(n[1]=e=>l.holdingsPage=e),"page-size":l.holdingsPageSize,total:l.totalHoldings,disabled:l.loadingPage,layout:"total, prev, pager, next",onCurrentChange:f.handlePageChange},null,8,["current-page","page-size","total","disabled","onCurrentChange"])])])):F("",!0)])]),_:1})]),_:1},8,["modelValue"])])}const Be=K(ge,[["render",He],["__scopeId","data-v-1c1e90cd"]]);export{Be as default};
