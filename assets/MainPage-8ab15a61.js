import{_ as b,m as D,u as V,C as H,A as N,g as k,r as v,a as B,o as n,c as l,b as c,w as A,F as U,d as E,e as C,f as a,h as G,i as R,v as K,j,k as O,l as q,n as W,p as J,q as r,t as y,s as T}from"./index-a8ff2a3b.js";import{I as Q}from"./inscription-1633049c.js";import{g as X,i as Y,a as Z,b as $,c as ee,d as te,e as se,f as ae,h as oe,j as ie,k as ne,l as le,m as z,n as de}from"./helpers-e4cbd948.js";import{d as x}from"./indexedDBCache-f3f71aef.js";import"./abi-cde10b30.js";const re=15,ce={name:"MainPage",data(){return{Document:D(G),Headset:D(R),VideoCamera:D(K),FolderOpened:D(j),Box:D(O),Coin:D(q),Loading:D(W),PictureFilled:D(J),kMaxPreviewBigChunksCount:10,loading:!1,inscriptions:[],currentPage:1,pageSize:re,total:0,forceRefreshKey:0}},computed:{walletStore(){return V()}},mounted(){this.loadInscriptions()},methods:{async loadInscriptions(){this.loading=!0;try{const o=H.getProvider(),t=new Q(o),m=await t.getItemIdCounter();this.total=m;const p=m-(this.currentPage-1)*this.pageSize,d=Math.max(1,p-this.pageSize+1);if(d<=p&&p>0){const f=await t.getItemList(d,p);this.inscriptions=[];const g=[];for(let i=f.length-1;i>=0;i--){const s=f[i],_=p-(f.length-1-i),u={id:_,dataType:s.dataType,userData:s.userData,fileName:X(s.userData),isImage:Y(s.dataType),isSVG:Z(s.dataType),isText:$(s.dataType),isTokenDeployment:ee(s.dataType),isMarkdown:te(s.dataType),isHTML:se(s.dataType),isAudio:ae(s.dataType),isVideo:oe(s.dataType),isArchive:ie(s.dataType),is3DModel:ne(s.dataType),isPDF:le(s.dataType),imageUrl:null,svgContent:null,text:null,isDataIncomplete:!1,incompleteDesc:null,isLoading:!1,isLargeData:!1,dataHolders:s.dataHolders},h=await x.get(_);h&&h.dataType===s.dataType?this.applyContentData(u,h.dataHex,s):s.inlineData&&s.inlineData.length>2?this.applyContentData(u,s.inlineData,s):u.isTokenDeployment?u.text=s.userData:s.dataHolders&&s.dataHolders.length>0&&(u.isImage||u.isSVG||u.isText)&&(s.dataHolders.length>this.kMaxPreviewBigChunksCount?u.isLargeData=!0:(u.isLoading=!0,g.push({inscription:u,itemId:_,item:s}))),this.inscriptions.push(u)}this.loading=!1,g.length>0&&await this.batchLoadContent(g,t)}}catch(o){console.error("Failed to load inscriptions:",o),this.$message.error("Failed to load inscriptions")}finally{this.loading=!1}},async batchLoadContent(o,t){if(console.log("batchLoadContent",o),o.length>0)try{const p=o.slice(0,8),d=o.slice(8,8*2),f=[];p.length>0&&f.push(this.loadBatch(p,t)),d.length>0&&f.push(this.loadBatch(d,t)),await Promise.all(f)}catch(m){console.error("Failed to batch load content:",m),o.forEach(p=>{p.inscription.isLoading=!1,p.inscription.isLargeData=!0}),this.forceRefreshKey++}},async loadBatch(o,t){const m=o.map(g=>g.itemId),[p,d,f]=await t.readDataList(m,this.kMaxPreviewBigChunksCount);for(let g=0;g<o.length;g++){let{inscription:i,item:s}=o[g];const _=p[g],u=f[g];i.isLargeData=!1,i.isDataIncomplete=!1,i.incompleteDesc="";try{if(_==2){const h=N.defaultAbiCoder().decode(["bytes"],u)[0];this.applyContentData(i,h,s),await x.set(m[g],h,s.dataType,!1)}else _==1?(i.isDataIncomplete=!0,i.incompleteDesc="Incomplete chunks"):(i.isDataIncomplete=!0,i.incompleteDesc="Read fail")}catch(h){console.error(`Failed to process content for item ${m[g]}:`,h),i.isLargeData=!0}i.isLoading=!1,this.forceRefreshKey++}},applyContentData(o,t,m){try{o.isText?o.text=z(k(t)):o.isImage?o.imageUrl=de(k(t),m.dataType):o.isSVG&&(o.svgContent=z(k(t)))}catch(p){console.error("Failed to apply content data:",p)}},handleImageError(o){o.imageUrl=null,o.isLargeData=!0},handlePageChange(o){this.currentPage=o,this.loadInscriptions(),window.scrollTo({top:0,behavior:"smooth"})},goToDetail(o){this.$router.push(`/detail/${o}`)}}},pe={class:"page-container"},ge={class:"content-wrapper"},_e=["onClick"],ue={class:"card-content"},fe={key:0,class:"loading-content"},he={key:1,class:"text-content"},ye=["src","alt","onError"],me=["innerHTML"],ve={key:4,class:"text-content"},De={key:5,class:"large-data-content"},Te={key:6,class:"token-deployment-content"},ke={class:"token-symbol"},Ce={key:7,class:"file-icon-content"},ze={class:"file-name"},xe={key:8,class:"file-icon-content"},Le={class:"file-name"},Ie={key:9,class:"file-icon-content"},we={class:"file-name"},Pe={key:10,class:"file-icon-content"},Fe={class:"file-name"},Me={key:11,class:"file-icon-content"},Se={class:"file-name"},be={key:12,class:"file-icon-content"},Ve={class:"file-name"},He={key:13,class:"file-icon-content"},Ne={class:"file-name"},Be={key:14,class:"text-content"},Ae={style:{"margin-top":"8px"}},Ue={class:"card-footer"},Ee={class:"footer-id"},Ge=["title"],Re={key:1,class:"empty-state"},Ke={key:2,class:"pagination-wrapper"};function je(o,t,m,p,d,f){const g=v("Loading"),i=v("el-icon"),s=v("PictureFilled"),_=v("el-tag"),u=v("Coin"),h=v("Document"),L=v("Headset"),I=v("VideoCamera"),w=v("FolderOpened"),P=v("Box"),F=v("el-pagination"),M=B("loading");return n(),l("div",pe,[t[13]||(t[13]=c("h1",{class:"page-title"},"Latest Inscriptions",-1)),A((n(),l("div",ge,[d.inscriptions.length>0?(n(),l("div",{class:"inscription-grid",key:d.forceRefreshKey},[(n(!0),l(U,null,E(d.inscriptions,e=>(n(),l("div",{key:e.id,class:"inscription-card card-hover",onClick:S=>f.goToDetail(e.id)},[c("div",ue,[e.isLoading?(n(),l("div",fe,[a(i,{class:"is-loading",size:32,color:"#409EFF"},{default:r(()=>[a(g)]),_:1}),t[2]||(t[2]=c("p",null,"Loading content...",-1))])):e.isDataIncomplete?(n(),l("div",he,y(e.incompleteDesc),1)):e.isImage&&e.imageUrl&&!e.isLargeData?(n(),l("img",{key:2,src:e.imageUrl,alt:`Inscription #${e.id}`,onError:S=>f.handleImageError(e)},null,40,ye)):e.isSVG&&e.svgContent?(n(),l("div",{key:3,innerHTML:e.svgContent,class:"svg-content"},null,8,me)):e.isText&&!e.isLargeData?(n(),l("div",ve,y(e.text),1)):(e.isImage||e.isSVG||e.isText)&&e.isLargeData?(n(),l("div",De,[a(i,{size:48,color:"#909399"},{default:r(()=>[a(s)]),_:1}),t[4]||(t[4]=c("p",null,"Large Media File",-1)),a(_,{size:"small",type:"info"},{default:r(()=>[...t[3]||(t[3]=[T("Click to view",-1)])]),_:1})])):e.isTokenDeployment?(n(),l("div",Te,[a(i,{size:64},{default:r(()=>[a(u)]),_:1}),c("p",ke,[c("strong",null,"$"+y(e.text),1)])])):e.isMarkdown?(n(),l("div",Ce,[a(i,{size:48},{default:r(()=>[a(h)]),_:1}),c("div",ze,y(e.fileName),1),a(_,{size:"small"},{default:r(()=>[...t[5]||(t[5]=[T("Markdown",-1)])]),_:1})])):e.isHTML?(n(),l("div",xe,[a(i,{size:48},{default:r(()=>[a(h)]),_:1}),c("div",Le,y(e.fileName),1),a(_,{size:"small"},{default:r(()=>[...t[6]||(t[6]=[T("HTML",-1)])]),_:1})])):e.isAudio?(n(),l("div",Ie,[a(i,{size:48},{default:r(()=>[a(L)]),_:1}),c("div",we,y(e.fileName),1),a(_,{size:"small",type:"success"},{default:r(()=>[...t[7]||(t[7]=[T("Audio",-1)])]),_:1})])):e.isVideo?(n(),l("div",Pe,[a(i,{size:48},{default:r(()=>[a(I)]),_:1}),c("div",Fe,y(e.fileName),1),a(_,{size:"small",type:"warning"},{default:r(()=>[...t[8]||(t[8]=[T("Video",-1)])]),_:1})])):e.isArchive?(n(),l("div",Me,[a(i,{size:48},{default:r(()=>[a(w)]),_:1}),c("div",Se,y(e.fileName),1),a(_,{size:"small",type:"info"},{default:r(()=>[...t[9]||(t[9]=[T("Archive",-1)])]),_:1})])):e.is3DModel?(n(),l("div",be,[a(i,{size:48},{default:r(()=>[a(P)]),_:1}),c("div",Ve,y(e.fileName),1),a(_,{size:"small",type:"danger"},{default:r(()=>[...t[10]||(t[10]=[T("3D Model",-1)])]),_:1})])):e.isPDF?(n(),l("div",He,[a(i,{size:48},{default:r(()=>[a(h)]),_:1}),c("div",Ne,y(e.fileName),1),a(_,{size:"small",type:"danger"},{default:r(()=>[...t[11]||(t[11]=[T("PDF",-1)])]),_:1})])):(n(),l("div",Be,[a(i,{size:48},{default:r(()=>[a(h)]),_:1}),c("div",Ae,y(e.dataType),1)]))]),c("div",Ue,[c("div",Ee,"Inscription #"+y(e.id),1),e.userData?(n(),l("div",{key:0,class:"footer-userdata",title:e.userData},y(e.isTokenDeployment?"Token Deployment":e.userData),9,Ge)):C("",!0)])],8,_e))),128))])):d.loading?C("",!0):(n(),l("div",Re,[...t[12]||(t[12]=[c("div",{class:"empty-icon"},"ðŸ“",-1),c("div",{class:"empty-text"},"No inscriptions found",-1)])])),d.total>d.pageSize?(n(),l("div",Ke,[a(F,{"current-page":d.currentPage,"onUpdate:currentPage":t[0]||(t[0]=e=>d.currentPage=e),"page-size":d.pageSize,"onUpdate:pageSize":t[1]||(t[1]=e=>d.pageSize=e),total:d.total,"page-sizes":[d.pageSize],layout:"total, prev, pager, next, jumper",onCurrentChange:f.handlePageChange},null,8,["current-page","page-size","total","page-sizes","onCurrentChange"])])):C("",!0)])),[[M,d.loading]])])}const Xe=b(ce,[["render",je],["__scopeId","data-v-12d6fc93"]]);export{Xe as default};
